import{ao as ke,ap as C,aq as se,ar as $,as as ie,at as $e,au as Ue,av as Ie,aw as U,ax as D,ay as X,az as We,aA as Be,aB as Me,aC as ze,d as He,y as Pe,aD as qe,I as Y,o as je,h as Je,H as Ye,D as K,r as S,c as Ke,w as G,aE as Qe,aF as Ze,aG as Xe,aH as et,f as tt,v as A,s as nt,Y as rt,j as L,aI as it,aJ as lt,N as ae}from"./tool-4bde39df.js";import{u as ot,i as st}from"./action-cd384d03.js";import"./modulepreload-polyfill-3cfb730f.js";class p{constructor(e,n,i,l){this.fromA=e,this.toA=n,this.fromB=i,this.toB=l}offset(e,n){return new p(this.fromA+e,this.toA+e,this.fromB+n,this.toB+n)}}function O(r,e,n,i,l,t){if(r==i)return[];let o=le(r,e,n,i,l,t),s=oe(r,e+o,n,i,l+o,t);e+=o,n-=s,l+=o,t-=s;let u=n-e,h=t-l;if(!u||!h)return[new p(e,n,l,t)];if(u>h){let c=r.slice(e,n).indexOf(i.slice(l,t));if(c>-1)return[new p(e,e+c,l,l),new p(e+c+h,n,t,t)]}else if(h>u){let c=i.slice(l,t).indexOf(r.slice(e,n));if(c>-1)return[new p(e,e,l,l+c),new p(n,n,l+c+u,t)]}if(u==1||h==1)return[new p(e,n,l,t)];let a=Se(r,e,n,i,l,t);if(a){let[c,f,d]=a;return O(r,e,c,i,l,f).concat(O(r,c+d,n,i,f+d,t))}return at(r,e,n,i,l,t)}let ee=1e9;function at(r,e,n,i,l,t){let o=n-e,s=t-l;if(Math.min(o,s)>ee*16)return ue(r,e,n,i,l,t);let u=Math.ceil((o+s)/2);Q.reset(u),Z.reset(u);let h=(d,m)=>r.charCodeAt(e+d)==i.charCodeAt(l+m),a=(d,m)=>r.charCodeAt(n-d-1)==i.charCodeAt(t-m-1),c=(o-s)%2!=0?Z:null,f=c?null:Q;for(let d=0;d<u;d++){if(d>ee)return ue(r,e,n,i,l,t);let m=Q.advance(d,o,s,u,c,!1,h)||Z.advance(d,o,s,u,f,!0,a);if(m)return ut(r,e,n,e+m[0],i,l,t,l+m[1])}return[new p(e,n,l,t)]}class De{constructor(){this.vec=[]}reset(e){this.len=e<<1;for(let n=0;n<this.len;n++)this.vec[n]=-1;this.vec[e+1]=0,this.start=this.end=0}advance(e,n,i,l,t,o,s){for(let u=-e+this.start;u<=e-this.end;u+=2){let h=l+u,a=u==-e||u!=e&&this.vec[h-1]<this.vec[h+1]?this.vec[h+1]:this.vec[h-1]+1,c=a-u;for(;a<n&&c<i&&s(a,c);)a++,c++;if(this.vec[h]=a,a>n)this.end+=2;else if(c>i)this.start+=2;else if(t){let f=l+(n-i)-u;if(f>=0&&f<this.len&&t.vec[f]!=-1)if(o){let d=t.vec[f];if(d>=n-a)return[d,l+d-f]}else{let d=n-t.vec[f];if(a>=d)return[a,c]}}}return null}}const Q=new De,Z=new De;function ut(r,e,n,i,l,t,o,s){let u=!1;return!R(r,i)&&++i==n&&(u=!0),!R(l,s)&&++s==o&&(u=!0),u?[new p(e,n,t,o)]:O(r,e,i,l,t,s).concat(O(r,i,n,l,s,o))}function Le(r,e){let n=1,i=Math.min(r,e);for(;n<i;)n=n<<1;return n}function le(r,e,n,i,l,t){if(e==n||e==t||r.charCodeAt(e)!=i.charCodeAt(l))return 0;let o=Le(n-e,t-l);for(let s=e,u=l;;){let h=s+o,a=u+o;if(h>n||a>t||r.slice(s,h)!=i.slice(u,a)){if(o==1)return s-e-(R(r,s)?0:1);o=o>>1}else{if(h==n||a==t)return h-e;s=h,u=a}}}function oe(r,e,n,i,l,t){if(e==n||l==t||r.charCodeAt(n-1)!=i.charCodeAt(t-1))return 0;let o=Le(n-e,t-l);for(let s=n,u=t;;){let h=s-o,a=u-o;if(h<e||a<l||r.slice(h,s)!=i.slice(a,u)){if(o==1)return n-s-(R(r,s)?0:1);o=o>>1}else{if(h==e||a==l)return n-h;s=h,u=a}}}function te(r,e,n,i,l,t,o,s){let u=i.slice(l,t),h=null;for(;;){if(h||o<s)return h;for(let a=e+o;;){R(r,a)||a++;let c=a+o;if(R(r,c)||(c+=c==a+1?1:-1),c>=n)break;let f=r.slice(a,c),d=-1;for(;(d=u.indexOf(f,d+1))!=-1;){let m=le(r,c,n,i,l+d+f.length,t),g=oe(r,e,a,i,l,l+d),w=f.length+m+g;(!h||h[2]<w)&&(h=[a-g,l+d-g,w])}a=c}if(s<0)return h;o=o>>1}}function Se(r,e,n,i,l,t){let o=n-e,s=t-l;if(o<s){let u=Se(i,l,t,r,e,n);return u&&[u[1],u[0],u[2]]}return o<4||s*2<o?null:te(r,e,n,i,l,t,Math.floor(o/4),-1)}function ue(r,e,n,i,l,t){let o=n-e,s=t-l,u;if(o<s){let f=te(i,l,t,r,e,n,Math.floor(o/6),50);u=f&&[f[1],f[0],f[2]]}else u=te(r,e,n,i,l,t,Math.floor(s/6),50);if(!u)return[new p(e,n,l,t)];let[h,a,c]=u;return O(r,e,h,i,l,a).concat(O(r,h+c,n,i,a+c,t))}function ye(r,e){for(let n=1;n<r.length;n++){let i=r[n-1],l=r[n];i.toA>l.fromA-e&&i.toB>l.fromB-e&&(r[n-1]=new p(i.fromA,l.toA,i.fromB,l.toB),r.splice(n--,1))}}function dt(r,e,n){for(;;){ye(n,1);let i=!1;for(let l=0;l<n.length;l++){let t=n[l],o,s;(o=le(r,t.fromA,t.toA,e,t.fromB,t.toB))&&(t=n[l]=new p(t.fromA+o,t.toA,t.fromB+o,t.toB)),(s=oe(r,t.fromA,t.toA,e,t.fromB,t.toB))&&(t=n[l]=new p(t.fromA,t.toA-s,t.fromB,t.toB-s));let u=t.toA-t.fromA,h=t.toB-t.fromB;if(u&&h)continue;let a=t.fromA-(l?n[l-1].toA:0),c=(l<n.length-1?n[l+1].fromA:r.length)-t.toA;if(!a||!c)continue;let f=u?r.slice(t.fromA,t.toA):e.slice(t.fromB,t.toB);a<=f.length&&r.slice(t.fromA-a,t.fromA)==f.slice(f.length-a)?(n[l]=new p(t.fromA-a,t.toA-a,t.fromB-a,t.toB-a),i=!0):c<=f.length&&r.slice(t.toA,t.toA+c)==f.slice(0,c)&&(n[l]=new p(t.fromA+c,t.toA+c,t.fromB+c,t.toB+c),i=!0)}if(!i)break}return n}function ht(r,e,n){for(let i=0,l=0;l<r.length;l++){let t=r[l],o=t.toA-t.fromA,s=t.toB-t.fromB;if(o&&s||o>3||s>3){let u=l==r.length-1?e.length:r[l+1].fromA,h=t.fromA-i,a=u-t.toA,c=he(e,t.fromA,Math.min(h,5)),f=de(e,t.toA,Math.min(a,5)),d=t.fromA-c,m=f-t.toA;if(!o||!s){let g=Math.max(o,s),[w,B,x]=o?[e,t.fromA,t.toA]:[n,t.fromB,t.toB],b,M;d&&m?(g>d&&e.slice(c,t.fromA)==w.slice(x-d,x)?(t=r[l]=new p(c,c+o,t.fromB-d,t.toB-d),c=t.fromA,f=de(e,t.toA,Math.min(u-t.toA,5))):g>m&&e.slice(t.toA,f)==w.slice(B,B+m)&&(t=r[l]=new p(f-o,f,t.fromB+m,t.toB+m),f=t.toA,c=he(e,t.fromA,Math.min(t.fromA-i,5))),d=t.fromA-c,m=f-t.toA):!d&&!m&&(M=t.fromA-(b=ct(e,t.fromA,h)))&&e.slice(b,t.fromA)==w.slice(x-M,x)&&(t=r[l]=new p(b,b+o,t.fromB-M,t.toB-M))}(d||m)&&(t=r[l]=new p(t.fromA-d,t.toA+m,t.fromB-d,t.toB+m)),i=t.toA}}return ye(r,3),r}let y;try{y=new RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch{}function Oe(r){return r>48&&r<58||r>64&&r<91||r>96&&r<123}function _e(r,e){if(e==r.length)return 0;let n=r.charCodeAt(e);return n<192?Oe(n)?1:0:y?!Te(n)||e==r.length-1?y.test(String.fromCharCode(n))?1:0:y.test(r.slice(e,e+2))?2:0:0}function Ee(r,e){if(!e)return 0;let n=r.charCodeAt(e-1);return n<192?Oe(n)?1:0:y?!Re(n)||e==1?y.test(String.fromCharCode(n))?1:0:y.test(r.slice(e-2,e))?2:0:0}function de(r,e,n){if(e==r.length||!Ee(r,e))return e;for(let i=e,l=e+n;;){let t=_e(r,i);if(!t)return i;if(i+=t,i>l)return e}}function he(r,e,n){if(!e||!_e(r,e))return e;for(let i=e,l=e-n;;){let t=Ee(r,i);if(!t)return i;if(i-=t,i<l)return e}}function ct(r,e,n){for(let i=e,l=e-n;;){let t=i?r.charCodeAt(i-1):10;if(t==10)return i;if(i--,i<l||t!=32&&t!=9)return e}}const Te=r=>r>=55296&&r<=56319,Re=r=>r>=56320&&r<=57343;function R(r,e){return!e||e==r.length||!Te(r.charCodeAt(e-1))||!Re(r.charCodeAt(e))}function ft(r,e,n){var i;return ee=((i=n==null?void 0:n.scanLimit)!==null&&i!==void 0?i:1e9)>>1,dt(r,e,O(r,0,r.length,e,0,e.length))}function Ve(r,e,n){return ht(ft(r,e,n),r,e)}const Fe={scanLimit:500};class T{constructor(e,n,i,l,t){this.changes=e,this.fromA=n,this.toA=i,this.fromB=l,this.toB=t}offset(e,n){return e||n?new T(this.changes,this.fromA+e,this.toA+e,this.fromB+n,this.toB+n):this}get endA(){return Math.max(this.fromA,this.toA-1)}get endB(){return Math.max(this.fromB,this.toB-1)}static build(e,n){return Ge(Ve(e.toString(),n.toString(),Fe),e,n,0,0)}static updateA(e,n,i,l){return pe(ge(e,l,!0,i.length),e,n,i)}static updateB(e,n,i,l){return pe(ge(e,l,!1,n.length),e,n,i)}}function ce(r,e,n,i){let l=n.lineAt(r),t=i.lineAt(e);return l.to==r&&t.to==e&&r<n.length&&e<i.length?[r+1,e+1]:[l.from,t.from]}function fe(r,e,n,i){let l=n.lineAt(r),t=i.lineAt(e);return l.from==r&&t.from==e?[r,e]:[l.to+1,t.to+1]}function Ge(r,e,n,i,l){let t=[];for(let o=0;o<r.length;o++){let s=r[o],[u,h]=ce(s.fromA+i,s.fromB+l,e,n),[a,c]=fe(s.toA+i,s.toB+l,e,n),f=[s.offset(-u+i,-h+l)];for(;o<r.length-1;){let d=r[o+1],[m,g]=ce(d.fromA+i,d.fromB+l,e,n);if(m>a+1&&g>c+1)break;f.push(d.offset(-u+i,-h+l)),[a,c]=fe(d.toA+i,d.toB+l,e,n),o++}t.push(new T(f,u,Math.max(u,a),h,Math.max(h,c)))}return t}const I=1e3;function me(r,e,n,i){let l=0,t=r.length;for(;;){if(l==t){let a=0,c=0;l&&({toA:a,toB:c}=r[l-1]);let f=e-(n?a:c);return[a+f,c+f]}let o=l+t>>1,s=r[o],[u,h]=n?[s.fromA,s.toA]:[s.fromB,s.toB];if(u>e)t=o;else if(h<=e)l=o+1;else return i?[s.fromA,s.fromB]:[s.toA,s.toB]}}function ge(r,e,n,i){let l=[];return e.iterChangedRanges((t,o,s,u)=>{let h=0,a=n?e.length:i,c=0,f=n?i:e.length;t>I&&([h,c]=me(r,t-I,n,!0)),o<e.length-I&&([a,f]=me(r,o+I,n,!1));let d=u-s-(o-t),m,[g,w]=n?[d,0]:[0,d];l.length&&(m=l[l.length-1]).toA>=h?l[l.length-1]={fromA:m.fromA,fromB:m.fromB,toA:a,toB:f,diffA:m.diffA+g,diffB:m.diffB+w}:l.push({fromA:h,toA:a,fromB:c,toB:f,diffA:g,diffB:w})}),l}function pe(r,e,n,i){if(!r.length)return e;let l=0,t=0,o=0,s=[];for(let u of r){let h=u.fromA+t,a=u.toA+t+u.diffA,c=u.fromB+o,f=u.toB+o+u.diffB;for(;l<e.length;){let d=e[l];if(d.toA+t<=h&&d.toB+o<=c)s.push(d.offset(t,o));else if(d.fromA+t>a)break;l++}for(let d of Ge(Ve(n.sliceString(h,a),i.sliceString(c,f),Fe),n,i,h,c))s.push(d);t+=u.diffA,o+=u.diffB}for(;l<e.length;)s.push(e[l++].offset(t,o));return s}const ne=$.define(),V=ie.define({create(r){return null},update(r,e){for(let n of e.effects)n.is(ne)&&(r=n.value);return r}}),k=$e.define({combine:r=>r[0]}),Ne=Ue.fromClass(class{constructor(r){({deco:this.deco,gutter:this.gutter}=be(r))}update(r){(r.docChanged||r.viewportChanged||mt(r.startState,r.state)||gt(r.startState,r.state))&&({deco:this.deco,gutter:this.gutter}=be(r.view))}},{decorations:r=>r.deco}),W=ke.low(Ie({class:"cm-changeGutter",markers:r=>{var e;return((e=r.plugin(Ne))===null||e===void 0?void 0:e.gutter)||X.empty},renderEmptyElements:!1}));function mt(r,e){return r.field(V,!1)!=e.field(V,!1)}function gt(r,e){return r.facet(k)!=e.facet(k)}const ve=D.line({class:"cm-changedLine"}),pt=D.mark({class:"cm-changedText"}),we=new class extends ze{constructor(){super(...arguments),this.elementClass="cm-changedLineGutter"}};function vt(r,e,n,i,l,t){let o=n?r.fromA:r.fromB,s=n?r.toA:r.toB,u=0;if(o!=s){l.add(o,o,ve),t&&t.add(o,o,we);for(let h=e.iterRange(o,s-1),a=o;!h.next().done;){if(h.lineBreak){a++,l.add(a,a,ve),t&&t.add(a,a,we);continue}let c=a+h.value.length;if(i)for(;u<r.changes.length;){let f=r.changes[u],d=o+(n?f.fromA:f.fromB),m=o+(n?f.toA:f.toB),g=Math.max(a,d),w=Math.min(c,m);if(g<w&&l.add(g,w,pt),m<c)u++;else break}a=c}}}function be(r){let e=r.state.field(V),{side:n,highlightChanges:i,markGutter:l}=r.state.facet(k),t=n=="a",o=new U,s=l?new U:null,{from:u,to:h}=r.viewport;for(let a of e){if((t?a.fromA:a.fromB)>=h)break;(t?a.toA:a.toB)>u&&vt(a,r.state.doc,t,i,o,s)}return{deco:o.finish(),gutter:s&&s.finish()}}class z extends Me{constructor(e){super(),this.height=e}eq(e){return this.height==e.height}toDOM(){let e=document.createElement("div");return e.className="cm-mergeSpacer",e.style.height=this.height+"px",e}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}const q=$.define({map:(r,e)=>r.map(e)}),N=ie.define({create:()=>D.none,update:(r,e)=>{for(let n of e.effects)if(n.is(q))return n.value;return r.map(e.changes)},provide:r=>C.decorations.from(r)}),H=1e-4;function wt(r,e,n){let i=new U,l=new U,t=r.viewportLineBlocks,o=e.viewportLineBlocks,s=0,u=0,h=r.state.field(N).iter(),a=e.state.field(N).iter(),c=0,f=0,d=0,m=0;e:for(let x=0;;x++){let b=x<n.length?n[x]:null,[M,F]=b?[b.fromA,b.fromB]:[r.state.doc.length,e.state.doc.length];if(c<M&&f<F)for(;;){if(s==t.length||u==o.length)break e;let v=t[s],_=o[u];for(;h.value&&h.from<v.from;)d-=h.value.spec.widget.height,h.next();for(;a.value&&a.from<_.from;)m-=a.value.spec.widget.height,a.next();if(v.from>=M||_.from>=F)break;let j=v.from-c,J=_.from-f;if(j<0||j<J)s++;else if(J<0||J<j)u++;else{let E=v.top+d-(_.top+m);E<-H?(d-=E,i.add(v.from,v.from,D.widget({widget:new z(-E),block:!0,side:-1}))):E>H&&(m+=E,l.add(_.from,_.from,D.widget({widget:new z(E),block:!0,side:-1}))),s++,u++}}if(!b)break;c=b.toA,f=b.toB}for(;h.value;)d-=h.value.spec.widget.height,h.next();for(;a.value;)m-=a.value.spec.widget.height,a.next();let g=r.contentHeight+d-(e.contentHeight+m);g<H?i.add(r.state.doc.length,r.state.doc.length,D.widget({widget:new z(-g),block:!0,side:1})):g>H&&l.add(e.state.doc.length,e.state.doc.length,D.widget({widget:new z(g),block:!0,side:1}));let w=i.finish(),B=l.finish();X.eq([w],[r.state.field(N)])||r.dispatch({effects:q.of(w)}),X.eq([B],[e.state.field(N)])||e.dispatch({effects:q.of(B)})}const re=$.define({map:(r,e)=>e.mapPos(r)});class bt extends Me{constructor(e){super(),this.lines=e}eq(e){return this.lines==e.lines}toDOM(e){let n=document.createElement("div");return n.className="cm-collapsedLines",n.textContent="⦚ "+e.state.phrase("$ unchanged lines",this.lines)+" ⦚",n.addEventListener("click",i=>{let l=e.posAtDOM(i.target);e.dispatch({effects:re.of(l)});let{side:t,sibling:o}=e.state.facet(k);o().dispatch({effects:re.of(xt(l,e.state.field(V),t=="a"))})}),n}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}}function xt(r,e,n){let i=0,l=0;for(let t=0;;t++){let o=t<e.length?e[t]:null;if(!o||(n?o.fromA:o.fromB)>=r)return l+(r-i);[i,l]=n?[o.toA,o.toB]:[o.toB,o.toA]}}const Ct=ie.define({create(r){return D.none},update(r,e){r=r.map(e.changes);for(let n of e.effects)n.is(re)&&(r=r.update({filter:i=>i!=n.value}));return r},provide:r=>C.decorations.from(r)});function xe({margin:r=3,minSize:e=4}){return Ct.init(n=>At(n,r,e))}function At(r,e,n){let i=new U,l=r.facet(k).side=="a",t=r.field(V),o=1;for(let s=0;;s++){let u=s<t.length?t[s]:null,h=s?o+e:1,a=u?r.doc.lineAt(l?u.fromA:u.fromB).number-1-e:r.doc.lines,c=a-h+1;if(c>=n&&i.add(r.doc.line(h).from,r.doc.line(a).to,D.replace({widget:new bt(c),block:!0})),!u)break;o=r.doc.lineAt(Math.min(r.doc.length,l?u.toA:u.toB)).number}return i.finish()}const kt=C.styleModule.of(new We({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}})),Bt=C.baseTheme({"& .cm-scroller, &":{height:"auto !important",overflowY:"visible !important"},"&.cm-merge-a .cm-changedLine":{backgroundColor:"rgba(160, 128, 100, .08)"},"&.cm-merge-b .cm-changedLine":{backgroundColor:"rgba(100, 160, 128, .08)"},"&light.cm-merge-a .cm-changedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb2266, #22bb2266) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff8866, #88ff8866) bottom/100% 2px no-repeat"},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer"},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"}}),Ce=new Be,P=new Be;class Mt{constructor(e){this.revertDOM=null,this.revertToA=!1,this.revertToLeft=!1,this.measuring=-1;let n=[ke.low(Ne),Bt,kt,N,C.updateListener.of(c=>{this.measuring<0&&(c.heightChanged||c.viewportChanged)&&!c.transactions.some(f=>f.effects.some(d=>d.is(q)))&&this.measure()})],i=[k.of({side:"a",sibling:()=>this.b,highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1})];e.gutter!==!1&&i.push(W);let l=se.create({doc:e.a.doc,selection:e.a.selection,extensions:[e.a.extensions||[],C.editorAttributes.of({class:"cm-merge-a"}),P.of(i),n]}),t=[k.of({side:"b",sibling:()=>this.a,highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1})];e.gutter!==!1&&t.push(W);let o=se.create({doc:e.b.doc,selection:e.b.selection,extensions:[e.b.extensions||[],C.editorAttributes.of({class:"cm-merge-b"}),P.of(t),n]});this.chunks=T.build(l.doc,o.doc);let s=[V.init(()=>this.chunks),Ce.of(e.collapseUnchanged?xe(e.collapseUnchanged):[])];l=l.update({effects:$.appendConfig.of(s)}).state,o=o.update({effects:$.appendConfig.of(s)}).state,this.dom=document.createElement("div"),this.dom.className="cm-mergeView",this.editorDOM=this.dom.appendChild(document.createElement("div")),this.editorDOM.className="cm-mergeViewEditors";let u=e.orientation||"a-b",h=document.createElement("div");h.className="cm-mergeViewEditor";let a=document.createElement("div");a.className="cm-mergeViewEditor",this.editorDOM.appendChild(u=="a-b"?h:a),this.editorDOM.appendChild(u=="a-b"?a:h),this.a=new C({state:l,parent:h,root:e.root,dispatch:c=>this.dispatch(c,this.a)}),this.b=new C({state:o,parent:a,root:e.root,dispatch:c=>this.dispatch(c,this.b)}),this.setupRevertControls(!!e.revertControls,e.revertControls=="b-to-a",e.renderRevertControl),e.parent&&e.parent.appendChild(this.dom),this.scheduleMeasure()}dispatch(e,n){if(e.docChanged){this.chunks=n==this.a?T.updateA(this.chunks,e.newDoc,this.b.state.doc,e.changes):T.updateB(this.chunks,this.a.state.doc,e.newDoc,e.changes),n.update([e,e.state.update({effects:ne.of(this.chunks)})]);let i=n==this.a?this.b:this.a;i.update([i.state.update({effects:ne.of(this.chunks)})]),this.scheduleMeasure()}else n.update([e])}reconfigure(e){if("orientation"in e){let t=e.orientation!="b-a";if(t!=(this.editorDOM.firstChild==this.a.dom.parentNode)){let o=this.a.dom.parentNode,s=this.b.dom.parentNode;o.remove(),s.remove(),this.editorDOM.insertBefore(t?o:s,this.editorDOM.firstChild),this.editorDOM.appendChild(t?s:o),this.revertToLeft=!this.revertToLeft,this.revertDOM&&(this.revertDOM.textContent="")}}if("revertControls"in e||"renderRevertControl"in e){let t=!!this.revertDOM,o=this.revertToA,s=this.renderRevert;"revertControls"in e&&(t=!!e.revertControls,o=e.revertControls=="b-to-a"),"renderRevertControl"in e&&(s=e.renderRevertControl),this.setupRevertControls(t,o,s)}let n="highlightChanges"in e,i="gutter"in e,l="collapseUnchanged"in e;if(n||i||l){let t=[],o=[];if(n||i){let s=this.a.state.facet(k),u=i?e.gutter!==!1:s.markGutter,h=n?e.highlightChanges!==!1:s.highlightChanges;t.push(P.reconfigure([k.of({side:"a",sibling:()=>this.b,highlightChanges:h,markGutter:u}),u?W:[]])),o.push(P.reconfigure([k.of({side:"b",sibling:()=>this.a,highlightChanges:h,markGutter:u}),u?W:[]]))}if(l){let s=Ce.reconfigure(e.collapseUnchanged?xe(e.collapseUnchanged):[]);t.push(s),o.push(s)}this.a.dispatch({effects:t}),this.b.dispatch({effects:o})}this.scheduleMeasure()}setupRevertControls(e,n,i){this.revertToA=n,this.revertToLeft=this.revertToA==(this.editorDOM.firstChild==this.a.dom.parentNode),this.renderRevert=i,!e&&this.revertDOM?(this.revertDOM.remove(),this.revertDOM=null):e&&!this.revertDOM?(this.revertDOM=this.editorDOM.insertBefore(document.createElement("div"),this.editorDOM.firstChild.nextSibling),this.revertDOM.addEventListener("mousedown",l=>this.revertClicked(l)),this.revertDOM.className="cm-merge-revert"):this.revertDOM&&(this.revertDOM.textContent="")}scheduleMeasure(){if(this.measuring<0){let e=this.dom.ownerDocument.defaultView||window;this.measuring=e.requestAnimationFrame(()=>{this.measuring=-1,this.measure()})}}measure(){wt(this.a,this.b,this.chunks),this.revertDOM&&this.updateRevertButtons()}updateRevertButtons(){let e=this.revertDOM,n=e.firstChild,i=this.a.viewport,l=this.b.viewport;for(let t=0;t<this.chunks.length;t++){let o=this.chunks[t];if(o.fromA>i.to||o.fromB>l.to)break;if(o.fromA<i.from||o.fromB<l.from)continue;let s=this.a.lineBlockAt(o.fromA).top+"px";for(;n&&+n.dataset.chunk<t;)n=Ae(n);n&&n.dataset.chunk==String(t)?(n.style.top!=s&&(n.style.top=s),n=n.nextSibling):e.insertBefore(this.renderRevertButton(s,t),n)}for(;n;)n=Ae(n)}renderRevertButton(e,n){let i;if(this.renderRevert)i=this.renderRevert();else{i=document.createElement("button");let l=this.a.state.phrase("Revert this chunk");i.setAttribute("aria-label",l),i.setAttribute("title",l),i.textContent=this.revertToLeft?"⇜":"⇝"}return i.style.top=e,i.setAttribute("data-chunk",String(n)),i}revertClicked(e){let n=e.target,i;for(;n&&n.parentNode!=this.revertDOM;)n=n.parentNode;if(n&&(i=this.chunks[n.dataset.chunk])){let[l,t,o,s,u,h]=this.revertToA?[this.b,this.a,i.fromB,i.toB,i.fromA,i.toA]:[this.a,this.b,i.fromA,i.toA,i.fromB,i.toB],a=l.state.sliceDoc(o,Math.max(o,s-1));o!=s&&h<=t.state.doc.length&&(a+=l.state.lineBreak),t.dispatch({changes:{from:u,to:Math.min(t.state.doc.length,h),insert:a},userEvent:"revert"}),e.preventDefault()}}destroy(){this.a.destroy(),this.b.destroy(),this.measuring>-1&&(this.dom.ownerDocument.defaultView||window).cancelAnimationFrame(this.measuring),this.dom.remove()}}function Ae(r){let e=r.nextSibling;return r.remove(),e}const yt=He({__name:"Diffs",async setup(r){let e,n;const i=ot(([e,n]=Pe(()=>st({a:"",b:"",option:{lineWrapping:!0,lang:"Text",collapse:!1,revert:"b-to-a"}},{paste:!1})),e=await e,n(),e)),l=qe();let t=Y(null),o=Y(null);const s=Y({index:0,chunks:[]}),u=async d=>{const m=lt(d);return m?await m.load():[]},h=async()=>[l.theme.raw==="dark"?Qe:Ze,C.updateListener.of(d=>{o.value&&d.docChanged&&(d.view.dom.contains(o.value.a.dom)&&d.state.doc.toString()!==i.current.a&&(i.current.a=d.state.doc.toString()),d.view.dom.contains(o.value.b.dom)&&d.state.doc.toString()!==i.current.b&&(i.current.b=d.state.doc.toString()))}),await u(i.current.option.lang),i.current.option.lineWrapping?C.lineWrapping:[],Xe($t("main_ui_input")),et()],a=async d=>{o.value&&o.value.destroy(),o.value=new Mt({a:{doc:i.current.a,extensions:await h()},b:{doc:i.current.b,extensions:await h()},parent:d,revertControls:i.current.option.revert,collapseUnchanged:i.current.option.collapse?{}:void 0,highlightChanges:!0,gutter:!0})},c=async()=>{i.current.a=await ae.simple(i.current.option.lang,"beautify",i.current.a),i.current.b=await ae.simple(i.current.option.lang,"beautify",i.current.b),a(t.value)},f=d=>{if(!o.value)return;const m=d==="next"?s.value.index+1:s.value.index-1,g=s.value.chunks[m];g&&(o.value.dom.scrollTo({top:o.value.a.lineBlockAt(g.fromA).top,behavior:"smooth"}),s.value.index=m)};return je(()=>{setTimeout(()=>{a(t.value)},200),Je.addListener("content_clear",()=>{i.current.a="",i.current.b="",a(t.value)})}),Ye(()=>{var d;(d=o.value)==null||d.destroy()}),K(()=>({color:l.theme.raw,option:i.current.option}),()=>a(t.value),{deep:!0}),K(()=>({a:i.current.a,b:i.current.b}),()=>{setTimeout(()=>{o.value&&(s.value.index=0,s.value.chunks=o.value.chunks.map(d=>({fromA:d.fromA}))||[])},1e3)},{immediate:!0}),K(()=>i.current,()=>{i.current.a===""||i.current.b===""||i.save()},{deep:!0}),(d,m)=>{const g=S("HeightResize"),w=S("Select"),B=S("Button"),x=S("Bool"),b=S("Dropdown"),M=S("Input"),F=S("Align");return tt(),Ke(F,{direction:"vertical",class:"ctool-diff"},{default:G(()=>[A(g,{ignore:"",append:[".ctool-page-option"],reduce:5},{default:G(({height:v})=>[nt("div",{ref_key:"container",ref:t,style:rt({height:`${v}px`,width:"100%",overflow:"hidden"})},null,4)]),_:1},8,["append"]),A(F,{class:"ctool-page-option",horizontal:"center"},{default:G(()=>[A(w,{modelValue:L(i).current.option.lang,"onUpdate:modelValue":m[0]||(m[0]=v=>L(i).current.option.lang=v),options:L(it)},null,8,["modelValue","options"]),A(B,{text:d.$t("code_beautify"),onClick:c},null,8,["text"]),A(x,{modelValue:L(i).current.option.lineWrapping,"onUpdate:modelValue":m[1]||(m[1]=v=>L(i).current.option.lineWrapping=v),label:d.$t("component_editor_line_wrapping"),border:""},null,8,["modelValue","label"]),A(x,{modelValue:L(i).current.option.collapse,"onUpdate:modelValue":m[2]||(m[2]=v=>L(i).current.option.collapse=v),label:d.$t("diffs_collapse"),border:""},null,8,["modelValue","label"]),A(b,{onSelect:m[3]||(m[3]=v=>L(i).current.option.revert=v),placeholder:d.$t("diffs_revert_direction"),options:[{value:"b-to-a",label:d.$t("diffs_right_to_left")},{value:"a-to-b",label:d.$t("diffs_left_to_right")}]},null,8,["placeholder","options"]),A(M,{center:"",disabled:s.value.chunks.length===0,"model-value":`${s.value.chunks.length?s.value.index+1:0} / ${s.value.chunks.length}`,width:130},{prepend:G(()=>[A(B,{disabled:s.value.chunks.length===0||s.value.index===0,text:"<",onClick:m[4]||(m[4]=v=>f("last"))},null,8,["disabled"])]),append:G(()=>[A(B,{disabled:s.value.chunks.length===0||s.value.index===s.value.chunks.length-1,text:">",onClick:m[5]||(m[5]=v=>f("next"))},null,8,["disabled"])]),_:1},8,["disabled","model-value"])]),_:1})]),_:1})}}});export{yt as default};
