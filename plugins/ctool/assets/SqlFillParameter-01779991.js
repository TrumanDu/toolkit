import{u as I,i as P}from"./action-cd384d03.js";import{d as w,y as T,z as A,D as b,r as h,A as O,c as k,w as S,f as _,v as p,B as R,k as V,j as c}from"./tool-4bde39df.js";import"./modulepreload-polyfill-3cfb730f.js";const F=w({__name:"SqlFillParameter",async setup($){let o,g;const m=["String","Integer","Long","Timestamp"],n=I(([o,g]=T(()=>P({input:"",params:""})),o=await o,g(),o)),v=e=>{if(e){let u=e.split(",",-1),t=[],l=0,s=!1;return u.forEach(r=>{r.endsWith("null")?(t.push(r),l++):r.endsWith(")")?(s?(t[l]+=","+r,s=!1):t.push(r),l++):t[l]?t[l]+=","+r:(t.push(r),s=!0)}),t.map(r=>{let i=r.lastIndexOf("(");if(i<0)return{value:r,type:null};let a=r.substring(0,i);a=a.trim(),a=a.replaceAll("'","\\'");let d=r.lastIndexOf(")");d<0&&(d=r.length);let f=r.substring(i+1,d);return f=f.trim(),{value:a,type:f}})}else return[]},E=()=>{if(!n.current.input||!n.current.params)return"";let e=v(n.current.params),u=n.current.input,t="",l=0,s="";for(let r=0;r<u.length;r++){let i=u.charAt(r);if(i==="?"){if(e.length<=l)throw new Error($t("sqlFillParameter_parameter_too_little"));let a=e[l];switch(a.type){case m[0]:s=" '"+a.value+"'";break;case m[1]:case m[2]:s=a.value;break;case m[3]:s="Timestamp '"+a.value+"'";break;default:s=a.value}t+=s,l++}else t+=i}return t},q=e=>{const u={sql:"",params:""};let t="Preparing:",l=e.indexOf(t);l<0?l=0:l+=t.length;let s=e.indexOf(`
`,l);s<0&&(s=e.length),u.sql=e.substring(l,s);let r="Parameters:",i=e.indexOf(r);if(i>=0){let a=e.indexOf(`
`,i);a<0&&(a=e.length),u.params=e.substring(i+r.length,a)}return u},y=A(()=>{try{if(!n.current.input||!n.current.params)return"";let e=E();return n.save(),e}catch(e){return $error(e)}});return b(()=>({input:n.current.input,params:n.current.params}),({input:e,params:u})=>{if(e!==""&&e.includes("Preparing:")&&e.includes("Parameters:")){const t=q(e);t.sql!==""&&t.params!==""&&setTimeout(()=>{n.current.input=t.sql,n.current.params=t.params})}},{immediate:!0}),(e,u)=>{const t=h("Textarea"),l=h("Align"),s=h("HeightResize"),r=O("row");return _(),k(s,{ignore:"",reduce:5},{default:S(({height:i})=>[p(l,{direction:"vertical"},{default:S(()=>[R((_(),V("div",null,[p(t,{modelValue:c(n).current.input,"onUpdate:modelValue":u[0]||(u[0]=a=>c(n).current.input=a),height:i/2,placeholder:"Sql:SELECT * FROM T WHERE id=? AND name = ?",copy:"Sql"},null,8,["modelValue","height"]),p(t,{modelValue:c(n).current.params,"onUpdate:modelValue":u[1]||(u[1]=a=>c(n).current.params=a),height:i/2,placeholder:`${e.$t("sqlFillParameter_parameter")}:1(Integer),zhangshan(String)`,copy:e.$t("sqlFillParameter_parameter")},null,8,["modelValue","height","placeholder","copy"])])),[[r,"1-1"]]),p(t,{"model-value":y.value,copy:"",height:i/2,placeholder:`${e.$t("main_ui_output")}:SELECT * FROM T WHERE id=1 AND name='zhangshan'`},null,8,["model-value","height","placeholder"])]),_:2},1024)]),_:1})}}});export{F as default};
